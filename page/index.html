<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection" />
		<meta content="email=no" name="format-detection" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<title>巅峰社交</title>
		<link rel="stylesheet" href="../libs/css/base.css" />
		<link rel="stylesheet" href="../libs/swiper/swiper.min.css" />
		<script type="text/javascript" src="../libs/js/rem.js"></script>
		<style>
			html {
        background: #635069;
      }

      .box {
        width: 94%;
        height: 100%;
        margin: 0 3%;
        font-family: 'PingFangSC-Regular';
      }

      .input-search {
        position: relative;
      }

      .box .search-input {
        width: 100%;
        height: 0.75rem;
        margin: 0.2rem 0;
        border-radius: 0.375rem;
        background: #fff3f3f3;
        outline: none;
        border: none;
        padding-left: 2rem;
        font-size: 0.28rem;
        color: #b1b1b1;
      }

      .search-input::-webkit-input-placeholder {
        color: #b1b1b1;
      }

      .input-search .magnifier {
        width: 0.28rem;
        height: 0.28rem;
        position: absolute;
        top: 0.44rem;
        left: 1.6rem;
      }

      .swiper-slide {
        border-radius: 0.08rem;
      }
			.swiper-slide img{
				width: 7.02rem;
				height: 3.31rem;
				border-radius: 0.1rem;
			}
      .select-list {
        margin-top: 0.28rem;
        font-size: 0.32rem;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        justify-content: space-around;
        color: #fff;
      }

      .select-list .selected {
        border-bottom: 4px solid #d01fe0;
      }

      .select-list .select {
        border: none;
        outline: none;
        background: transparent;
        color: #fff;
      }

      .select-list .select option {
        color: #000;
      }

      .content {
        margin: 12px 0 70px;
        overflow: hidden;
      }

      .lists {
        float: left;
        width: 3.44rem;
        height: 4.17rem;
        border-radius: 0.12rem;
        overflow: hidden;
        background: #fff;
        margin-bottom: 1.7%;
        position: relative;
      }

      .lists:nth-child(2n-1) {
        margin-right: 1.7%;
      }

      .lists .head-img {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
		
      }

      .lists .sign {
        position: absolute;
        top: 0.05rem;
        left: 0;
        width: 1.85rem;
        height: 0.43rem;
      }

      .lists .list-info {
        width: 100%;
        height: 0.72rem;
        position: absolute;
        bottom: 0;
        left: 0;
        background: #000;
        color: #fff;
        line-height: 0.68rem;
        font-size: 0.26rem;
        padding: 0 1.3%;
        opacity: 0.4;
      }
			.lists>img{
				width: 100%;
				height: 4.17rem;
				display: block;
				object-fit:cover;
			}
      .list-info .list-tit {
        display: inline-block;
        width: 2.08rem;
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
      }

      .list-info .list-nums {
        position: absolute;
        right: 0.15rem;
      }

      .list-info .heart {
        width: 0.19rem;
        height: 0.19rem;
      }

      .footer {
        width: 100%;
        height: 1rem;
        background: #fff;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
      }

      .footer nav {
        padding-top: 0.1rem;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        justify-content: space-around;
        line-height: 1;
        text-align: center;
      }

      .footer nav p {
        color: #989898;
      }

      .footer .icon {
        width: 0.49rem;
        height: 0.49rem;
      }

      .footer .select-btn p {
        color: #2b3047;
      }
	  .fangda_box{
		  width: 100%;
		  height: 100%;
		  background: #000000;
		  display: none;
		  position: fixed;
		  top:0;
		  left: 0;
		  z-index: 50;
	  }
	  .fangda_box img{
		  width: 100%;
		  position: absolute;
		  top: 0;
		  bottom: 0;
		  margin: auto;
	  }
	  .guding {
	  	width: 100%;
	  	overflow-y: hidden;
	  	/*为了兼容普通PC的浏览器*/
	  	height: 100%;
	  	position: fixed;
	  }
    </style>
	</head>

	<body>
		<div class="box">
			<!-- 搜索 -->
			<div class="input-search">
				<input type="text" class="search-input" placeholder="搜索（输入主播名称或ID）" />
				<img src="../assets/jtw/Magnifier.png" alt="" class="magnifier" />
			</div>
			<!-- 轮播 -->
			<div class="swiper-container">
				<div class="swiper-wrapper lunbo">

				</div>
				<div class="swiper-pagination"></div>
			</div>
			<!-- 排序 -->
			<div class="select-list">
				<div class="new newHot selected">最新</div>
				<div class="hot newHot ">最热</div>
				<div class="sort ">
					<select class="select" id="pingtai">
						<option value="">分类</option>
					</select>
				</div>
			</div>
			<!-- 列表 -->
			<div class="content">

			</div>
			<!-- 点击放大 -->
			<div class="fangda_box">
				<img src="" alt="" class="fangda">
			</div>
		</div>
		<!--尾部 -->
		<footer class="footer">
			<nav>
				<a href="index.html" class="select-btn">
					<img src="../assets/jtw/home-select.png" alt="" class="icon" />
					<p>首页</p>
				</a>
				<a href="rank.html">
					<img src="../assets/jtw/bang.png" alt="" class="icon" />
					<p>榜单</p>
				</a>
				<a href="personal.html">
					<img src="../assets/jtw/mine.png" alt="" class="icon" />
					<p>我的</p>
				</a>
			</nav>
		</footer>
		<script src="../libs/js/jquery.min.js"></script>
		<script src="../libs/swiper/swiper.min.js"></script>
		<script>
			$(function() {
				// 页面进来获取到后台的openid  nickname  avatar
				function getQueryString(name) {
					var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
					var reg_rewrite = new RegExp("(^|/)" + name + "/([^/]*)(/|$)", "i");
					var r = window.location.search.substr(1).match(reg);
					var q = window.location.pathname.substr(1).match(reg_rewrite);
					if (r != null) {
						return unescape(r[2]);
					} else if (q != null) {
						return unescape(q[2]);
					} else {
						return null;
					}
				}
				var openid = getQueryString("openid");
				var nickname = getQueryString("nickname");
				var avatar = getQueryString("avatar");
				localStorage.setItem("openid", openid);
				localStorage.setItem("nickname", nickname);
				localStorage.setItem("avatar", avatar);
				// 没有登录跳转登录
				if (!localStorage.account_id) {
					window.location.href = "login/login.html"
					return;
					console.log('没有登录')
				}
				localStorage.setItem("yuming", "https://peak.bestlsw.top");
				// 首页轮播
				var url = localStorage.yuming
				$.ajax({
					url: url + "/api.php/interfaces/index/carousel_api",
					data: {
						// account_id:localStorage.account_id,
					},
					dataType: 'json', //服务器返回json格式数据
					success: function(data) {
						console.log(data);
						if (data.code == 1) {
							// 轮播图
							var pick = data.data.carousel
							var picker = '';
							$.each(pick, function(i, obj) {
								picker += '<div class="swiper-slide" onclick="img_dian('+i+')">'
								picker += '<img src="' + obj + '" class="img_dian">';
								picker += '</div>'
							})
							$('.lunbo').html(picker)
							my_swiper();
						}
					}
				});

				// 平台选择  平台发生改变时触发list函数
				//获取平台
				$.ajax({
					url: url + "/api.php/interfaces/index/get_platform",
					data: {

					},
					dataType: 'json', //服务器返回json格式数据
					success: function(data) {
						console.log(data);
						if (data.code == 1) {
							var pick = data.data.platform
							var picker = '';
							$.each(pick, function(i, obj) {

								picker += '<option value="' + obj.id + '">'
								picker += obj.platform_name
								picker += '</option>'
							})
							$('#pingtai').append(picker)
						}
					}
				})
				var page=1
				var category = ''
				$('#pingtai').change(function() {
					category = $(this).val()
					list1();
					page=1
				})
				// 最新或最热 改变时触发list函数
				var type = 1;
				$('.newHot').on('click', function() {
					if ($(this).hasClass('selected')) {
						return false
					} else {
						$(this)
							.siblings()
							.removeClass('selected')
							.end()
							.addClass('selected')
						var tabName = $(this).text()
						if (tabName == '最新') {
							type = 1
							page=1
						} else if (tabName == '最热') {
							type = 2
							page=1
						}
						// return alert('切换至：' + type)
						list1();
					}
				})
				// 搜索框发生改变时触发list方法
				var serch = ''
				$(".search-input").on('input propertychange', function() {
					// console.log($(this).val())
					serch = $(this).val()
					list1();
					page=1
				});
				
				function list() {
					// 首页列表
					$.ajax({
						url: url + "/api.php/interfaces/index/shouye",
						data: {
							type: type,
							category: category,
							search: serch,
							page:page,
							pagesize:8
						},
						dataType: 'json', //服务器返回json格式数据
						success: function(data) {
							console.log(data);
							if (data.code == 1) {
								var list_con = data.data.list;
								// 如果没有数据 让'暂无数据展出出来'
								if (list_con.length == 0&&page==1) {
									$('.content').html(
										'<div class="no_num" style="color: white;text-align: center;margin-top: 1rem;">暂无数据</div>');
									return;
								}
								var list_content = '';
								$.each(list_con, function(i, obj) {
									if (obj.img == url) {
										obj.img = ''
									}
									list_content += '<div class="lists" onclick="my_open(' + obj.account_id + ')">'
									list_content += '<img src="' + obj.img + '">'
									list_content += obj.num_one == 1 ? '<img src="../assets/jtw/weektop.png" alt="" class="sign" />' : '';
									list_content += '<div class="list-info">'
									list_content += '<span class="list-tit">'
									list_content += obj.username
									list_content += '</span>'
									list_content += '<span class="list-nums">'
									list_content += '<img src="../assets/jtw/heart.png" alt="" class="heart" />'
									list_content += '<span class="list-num">'
									list_content += obj.inc_hotnum
									list_content += '</span>'
									list_content += '</span>'
									list_content += '</div>'
									list_content += '</div>'
								})
								$('.content').append(list_content)

							}
						}
					});
				}
				// 搜索时用这个方法
				function list1() {
					// 首页列表
					$.ajax({
						url: url + "/api.php/interfaces/index/shouye",
						data: {
							type: type,
							category: category,
							search: serch,
							page:page,
							pagesize:4
						},
						dataType: 'json', //服务器返回json格式数据
						success: function(data) {
							// console.log(data);
							if (data.code == 1) {
								var list_con = data.data.list;
								// 如果没有数据 让'暂无数据展出出来'
								if (list_con.length == 0&&page==1) {
									$('.content').html(
										'<div class="no_num" style="color: white;text-align: center;margin-top: 1rem;">暂无数据</div>');
									return;
								}
								var list_content = '';
								$.each(list_con, function(i, obj) {
									if (obj.img == url) {
										obj.img = ''
									}
									list_content += '<div class="lists" onclick="my_open(' + obj.account_id + ')">'
									list_content += '<img src="' + obj.img + '">'
									list_content += obj.num_one == 1 ? '<img src="../assets/jtw/weektop.png" alt="" class="sign" />' : '';
									list_content += '<div class="list-info">'
									list_content += '<span class="list-tit">'
									list_content += obj.username
									list_content += '</span>'
									list_content += '<span class="list-nums">'
									list_content += '<img src="../assets/jtw/heart.png" alt="" class="heart" />'
									list_content += '<span class="list-num">'
									list_content += obj.inc_hotnum
									list_content += '</span>'
									list_content += '</span>'
									list_content += '</div>'
									list_content += '</div>'
								})
								$('.content').html(list_content)
				
							}
						}
					});
				}
				list();

				function my_swiper() {
					var mySwiper = new Swiper('.swiper-container', {
						autoplay: {
							delay: 2500
						},
						loop: true, // 循环模式选项
						speed: 300,
						pagination: {
							el: '.swiper-pagination',
						}
					})
				}
				
				var timers = null;
				$(window).scroll(function() {
					//当时滚动条离底部60px时开始加载下一页的内容
					if (($(window).height() + $(window).scrollTop() + 60) >= $(document).height()) {
						clearTimeout(timers);
						timers = setTimeout(function() {
							page++;
							console.log("第" + page + "页");
							list();
						}, 300);
					}
				});
				
				
				
			})

			function my_open(account_id) {
				window.location.href = "anchor.html?account_id=" + account_id
				console.log(account_id)
			}
			function img_dian(xiabiao) {
				console.log(xiabiao)
				var xiabiao_z=Number(xiabiao)+1
				var ul_li = $('.swiper-slide:eq(' + xiabiao_z + ')>img')
				var ul_li_img = ul_li[0].src
				$('.fangda_box').show();
				$('.fangda').attr('src',ul_li_img)
				$('meta').attr('content','width=device-width,initial-scale=1.0,maximum-scale=2.0,user-scalable=yes')
				$('body').addClass('guding');
			}
			$('.fangda_box').click(function(){
				$('.fangda_box').hide();
				$('meta').attr('content','width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no')
				$('body').removeClass('guding');
			})
		</script>
	</body>
</html>
